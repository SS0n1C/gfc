import{r as q,o as L,t as Q,v as I,x as r,J as $,K as B,u as S,L as R,M as x,j as O,y as v,N as y,z as b,A as z,B as j,O as P}from"./C9hKudH2.js";import T from"./Ddqr2ZbS.js";import{a as E,g as M,b as V,c as k}from"./DWHMFDJE.js";import{g as Y,a as X}from"./DQeTf7gL.js";import{_ as F}from"./D5rSib7j.js";const J={ref:"wrapper",class:"scratch-wrapper"},K=["width","height"],G={__name:"scratch",props:{width:{type:Number,default:300},height:{type:Number,default:120},brush:{type:Number,default:25},threshold:{type:Number,default:50}},emits:["completed"],setup(h,{expose:e,emit:i}){const o=h,p=i,u=q(null);let c,a=!1,d=!1;const N=(t,s)=>{c.globalCompositeOperation="destination-out",c.beginPath(),c.arc(t,s,o.brush,0,Math.PI*2),c.fill()},D=()=>{const{data:t}=c.getImageData(0,0,o.width,o.height);let s=0;for(let m=3;m<t.length;m+=4)t[m]===0&&s++;return s/(o.width*o.height)*100},g=t=>{var _,l,n,f;if(!a||d)return;const s=u.value.getBoundingClientRect(),m=(((l=(_=t.touches)==null?void 0:_[0])==null?void 0:l.clientX)??t.clientX)-s.left,C=(((f=(n=t.touches)==null?void 0:n[0])==null?void 0:f.clientY)??t.clientY)-s.top;N(m,C),D()>o.threshold&&(d=!0,p("completed"))};return e({revealAll:()=>{c&&(c.clearRect(0,0,o.width,o.height),d=!0)}}),L(()=>{c=u.value.getContext("2d",{willReadFrequently:!0});const t=new Image;t.src="scratchCard.jpg",t.onload=()=>{c.drawImage(t,0,0,o.width,o.height)};const s=u.value;s.addEventListener("mousedown",()=>a=!0),s.addEventListener("mouseup",()=>a=!1),s.addEventListener("mousemove",g),s.addEventListener("touchstart",()=>a=!0),s.addEventListener("touchend",()=>a=!1),s.addEventListener("touchmove",g)}),(t,s)=>(I(),Q("div",J,[r("canvas",{ref_key:"canvas",ref:u,width:h.width,height:h.height},null,8,K),r("div",{class:"content",style:B({width:h.width+"px",height:h.height+"px"})},[$(t.$slots,"default")],4)],512))}},H={class:"questSection flex justify-around grow rounded-t-[20px] p-8"},W={class:"min-w-full flex flex-col gap-y-[15px]"},Z={class:"questOption flex justify-around"},tt={class:"questText min-w-[200px] flex justify-center items-center grow"},et={class:"flex justify-center items-center grow"},st={class:"flex justify-center items-center grow text-center"},nt={class:"flex justify-center items-center"},ot={__name:"slugPage",async setup(h){let e,i;const o=q(null),p=S(),u=R(),c=([e,i]=x(()=>E.get()),e=await e,i(),e),a=([e,i]=x(()=>M(c)),e=await e,i(),e),d=Y();[e,i]=x(()=>V(d)),e=await e,i();const D=O(()=>X(d)).value,g=Object.values(D),A=u.params.slug;let t={};const s=g.find(l=>t=l.quiz.find(n=>n.slug==A));async function m(){try{const l=a.questID,n=a.data,f=[...l,t.id],w=String(Number(n)+Number(t.price));await k(a,f,w)}finally{await p.push("/")}}async function C(){try{const n=[...a.questID,t.id];await k(a,n)}finally{await p.push("/")}}function _(){var l;(l=o.value)==null||l.revealAll()}return(l,n)=>{const f=G,w=T;return I(),Q("section",H,[r("div",W,[r("div",Z,[r("div",null,v(y(s).name),1),r("div",null,v(y(t).price),1)]),r("div",tt,[r("div",null,v(y(t).quest),1)]),r("div",et,[b(f,{ref_key:"scratch",ref:o,width:200,height:60,threshold:80,onCompleted:_},{default:z(()=>[r("div",st,v(y(t).answer),1)]),_:1},512)]),r("div",nt,[r("button",{type:"button",class:"btn",onClick:n[0]||(n[0]=U=>m())},[b(w,{class:"btnIcon",name:"icon-park-solid:correct",style:{color:"green"},size:"20px"}),n[2]||(n[2]=j("Yes",-1))]),r("button",{type:"button",class:"btn",onClick:n[1]||(n[1]=U=>C())},[b(w,{class:"btnIcon",name:"icomoon-free:cross",style:{color:"red"},size:"20px"}),n[3]||(n[3]=j("No",-1))])])])])}}},ut={__name:"[slug]",async setup(h){let e,i;const o=S(),p=([e,i]=x(()=>E.get()),e=await e,i(),e);return L(async()=>{}),(u,c)=>{const a=ot,d=F;return I(),P(d,null,{default:z(()=>[b(a)]),_:1})}}};export{ut as default};
